# 分支保护和权限管理

## 🛡️ 分支保护策略

### Master分支保护
`master` 分支是项目的主分支，包含稳定的生产代码，需要严格的保护措施：

#### 保护规则
- ❌ **禁止直接推送** - 任何人都不能直接推送到master分支
- ✅ **必须通过PR** - 所有变更必须通过Pull Request
- ✅ **代码审查必需** - 至少需要1个维护者审查
- ✅ **状态检查** - 必须通过CI/CD检查（如果配置）
- ✅ **分支更新** - PR分支必须是最新的

#### 合并权限
只有以下角色可以合并到master分支：
- 项目所有者
- 项目维护者
- 具有管理员权限的协作者

### 协作分支管理
`contrib/volunteer-contributions` 分支是志愿者的主要协作分支：

#### 访问权限
- ✅ **读取权限** - 所有人可以克隆和查看
- ✅ **PR权限** - 志愿者可以创建PR到此分支
- ❌ **直接推送** - 志愿者不能直接推送到协作分支
- ✅ **分支创建** - 可以从此分支创建功能分支

#### 合并策略
- 维护者审查志愿者的PR
- 合并到协作分支进行集成测试
- 定期将稳定功能合并到master分支

## 👥 权限角色定义

### 项目所有者 (Owner)
**权限范围：**
- ✅ 完全的仓库管理权限
- ✅ 分支保护规则设置
- ✅ 协作者权限管理
- ✅ 发布版本管理
- ✅ 仓库设置修改

**职责：**
- 项目整体规划和方向
- 重大技术决策
- 社区管理和维护
- 发布流程管理

### 项目维护者 (Maintainer)
**权限范围：**
- ✅ 审查和合并PR
- ✅ 管理Issues和讨论
- ✅ 分支管理（除master外）
- ✅ 标签和里程碑管理
- ❌ 修改仓库核心设置

**职责：**
- 代码审查和质量控制
- 技术指导和支持
- 社区互动和答疑
- 功能规划和实现

### 志愿者贡献者 (Contributor)
**权限范围：**
- ✅ 创建功能分支
- ✅ 提交PR到协作分支
- ✅ 参与讨论和代码审查
- ✅ 报告Issues和建议
- ❌ 直接合并代码

**职责：**
- 功能开发和Bug修复
- 文档改进和测试
- 社区参与和反馈
- 遵循项目规范

## 🔄 工作流程权限

### 功能开发流程
```
志愿者 → 功能分支 → PR → 协作分支 → 审查 → 合并
                                ↓
维护者 → 测试验证 → PR → Master分支 → 发布
```

### 权限检查点
1. **功能分支创建** - 志愿者权限
2. **PR到协作分支** - 志愿者权限
3. **协作分支合并** - 维护者权限
4. **Master分支合并** - 维护者/所有者权限
5. **版本发布** - 所有者权限

## 🛠️ Git平台配置

### Gitee分支保护设置
由于使用Gitee平台，需要在仓库设置中配置：

#### Master分支保护
1. 进入仓库设置 → 分支管理
2. 选择master分支 → 设置保护
3. 配置保护规则：
   - 禁止强制推送
   - 禁止删除分支
   - 合并请求检查
   - 指定合并权限用户

#### 协作分支设置
1. 设置contrib/volunteer-contributions为受保护分支
2. 允许维护者合并PR
3. 要求代码审查
4. 启用分支更新检查

### 权限管理配置
1. **仓库成员管理**
   - 添加维护者为协作者
   - 设置适当的权限级别
   - 定期审查权限分配

2. **团队组织**
   - 创建维护者团队
   - 创建贡献者团队
   - 分配团队权限

## 📋 代码审查要求

### 必需审查项目
- [ ] **功能正确性** - 功能按预期工作
- [ ] **代码质量** - 符合项目编码规范
- [ ] **性能影响** - 不影响应用性能
- [ ] **安全性** - 没有安全漏洞
- [ ] **兼容性** - 与现有功能兼容
- [ ] **测试覆盖** - 包含必要的测试
- [ ] **文档更新** - 更新相关文档

### 审查流程
1. **自动检查** - CI/CD流水线检查
2. **人工审查** - 维护者代码审查
3. **测试验证** - 功能和回归测试
4. **文档检查** - 确保文档同步更新

## 🚨 应急处理

### 紧急Bug修复
对于紧急的生产Bug：
1. 创建hotfix分支从master
2. 快速修复并测试
3. 直接PR到master（跳过协作分支）
4. 加急审查和合并
5. 立即发布修复版本

### 权限应急调整
在特殊情况下：
- 临时提升权限处理紧急问题
- 事后恢复正常权限级别
- 记录权限变更日志

## 📊 权限监控

### 定期审查
- **月度权限审查** - 检查权限分配合理性
- **季度安全审计** - 全面安全检查
- **年度权限清理** - 清理不活跃用户权限

### 监控指标
- 分支保护规则遵循情况
- PR审查通过率
- 代码质量指标
- 安全漏洞检测

---

通过这些分支保护和权限管理措施，我们确保项目的稳定性和安全性，同时为志愿者提供友好的贡献环境。
